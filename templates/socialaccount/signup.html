{% extends 'base.html' %}
{% load static %}
{% load socialaccount %}
{% block title %} Complete Sign Up {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<style>
  /* Make the page fit without scrolling */
  body {
    overflow: hidden;
  }
  .main-content {
    height: calc(100vh - 80px);
    overflow: hidden;
  }
  .page-header {
    height: 100%;
    min-height: auto !important;
  }
  .signup-container {
    height: 100%;
    display: flex;
    align-items: center;
  }
  .oblique-bg {
    background-image: url("{% static 'assets/img/curved6.jpg' %}");
    background-size: cover;
    background-position: center;
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    z-index: 0;
    margin-left: -6rem;
  }
  .text-error {
    color: red;
    font-size: 0.7rem;
    margin-top: -0.5rem;
    margin-bottom: 0.25rem;
  }
  .card-plain {
    margin: 0 !important;
  }
  .card-header {
    padding-bottom: 0.5rem !important;
  }
  .card-body {
    padding: 1rem !important;
  }
  .card-footer {
    padding-top: 0.5rem !important;
  }
  .mb-3 {
    margin-bottom: 0.75rem !important;
  }
  label {
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
  }
  .btn.w-100 {
    padding: 0.6rem 1rem;
  }
  .form-control {
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
  }
  .provider-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.35rem 0.75rem;
    border-radius: 2rem;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }
  .provider-badge i {
    font-size: 1rem;
  }
  .provider-google { background: #fce8e6; color: #ea4335; }
  .provider-github { background: #e8eaed; color: #24292e; }
  .provider-facebook { background: #e7f0fd; color: #1877f2; }
  .provider-twitter_oauth2, .provider-twitter { background: #e8e8e8; color: #000; }
  .provider-linkedin { background: #e1f0fa; color: #0a66c2; }
  .provider-default { background: #e8f5e9; color: #344767; }
  .info-text {
    font-size: 0.8rem;
    color: #6c757d;
    line-height: 1.4;
  }
</style>
{% endblock stylesheets %}

{% block content %}
  <section>
    <div class="page-header">
      <div class="container signup-container">
        <div class="row w-100">
          <div class="col-xl-4 col-lg-5 col-md-6 d-flex flex-column mx-auto">
            <div class="card card-plain">
              <div class="card-header pb-0 text-left bg-transparent">
                <h4 class="text-info text-gradient">Almost There!</h4>
                <p class="mb-0 info-text">
                  {% if account.get_provider %}
                    <span class="provider-badge provider-{{ account.provider }}">
                      {% if account.provider == 'google' %}
                        <i class="fab fa-google"></i> Google
                      {% elif account.provider == 'github' %}
                        <i class="fab fa-github"></i> GitHub
                      {% elif account.provider == 'facebook' %}
                        <i class="fab fa-facebook-f"></i> Facebook
                      {% elif account.provider == 'twitter_oauth2' or account.provider == 'twitter' %}
                        <i class="fab fa-x-twitter"></i> X
                      {% elif 'linkedin' in account.provider %}
                        <i class="fab fa-linkedin-in"></i> LinkedIn
                      {% else %}
                        <i class="fas fa-link"></i> {{ account.get_provider.name }}
                      {% endif %}
                    </span>
                    <br>
                    Please complete your profile to finish signing in.
                    {% if account.provider == 'twitter_oauth2' or account.provider == 'twitter' %}
                      <br><small class="text-muted">If you already have an account, enter its email to link your X account.</small>
                    {% endif %}
                  {% else %}
                    Complete your profile to finish signing up.
                  {% endif %}
                </p>
              </div>
              <div class="card-body">
                <form role="form text-left" method="post" action="{% url 'socialaccount_signup' %}">
                  {% csrf_token %}

                  <label>Email</label>
                  <div class="mb-3">
                    {{ form.email }}
                  </div>
                  {% if form.email.errors %}
                  <div class="text-error">
                    {% for error in form.email.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                  {% endif %}

                  <label>Username</label>
                  <div class="mb-3">
                    {{ form.username }}
                  </div>
                  {% if form.username.errors %}
                  <div class="text-error">
                    {% for error in form.username.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                  {% endif %}

                  {% if form.non_field_errors %}
                  <div class="text-error" style="margin-bottom: 0.5rem;">
                    {% for error in form.non_field_errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                  {% endif %}

                  {{ redirect_field }}

                  <div class="text-center">
                    <button type="submit" class="btn bg-gradient-info w-100 mt-3 mb-0">Complete Sign Up</button>
                  </div>
                </form>
              </div>
              <div class="card-footer text-center pt-0 px-lg-2 px-1">
                <p class="mb-4 text-sm mx-auto">
                  Already have an account?
                  <a href="{% url 'login' %}" class="text-info text-gradient font-weight-bold">Sign IN</a>
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="oblique position-absolute top-0 h-100 d-md-block d-none me-n8">
              <div class="oblique-image bg-cover position-absolute fixed-top ms-auto h-100 z-index-0 ms-n6 oblique-bg"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock content %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = { damping: '0.5' }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
{% endblock javascripts %}
